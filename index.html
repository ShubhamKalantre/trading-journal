<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trading Journal ‚Äî Lite</title>
  <style>
    :root{--bg:#f3f6f9;--card:#ffffff;--muted:#6b7280;--accent:#2563eb}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Arial;background:var(--bg);color:#111}
    .app{display:flex;min-height:100vh}

    /* sidebar */
    .sidebar{width:220px;background:#111827;color:#fff;padding:18px;display:flex;flex-direction:column;gap:18px}
    .nav a{display:block;color:#ddd;padding:10px;text-decoration:none;border-radius:6px}
    .nav a:hover{background:#1f2937}

    /* main */
    .main{flex:1;padding:24px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:20px}
    .card{background:#fff;padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
    .kpi{font-size:28px;font-weight:700}
    .sub{color:var(--muted);font-size:13px}

    /* form */
    .journal{margin-top:22px;background:#fff;padding:14px;border-radius:12px}
    form .row{display:flex;gap:12px;margin-bottom:10px}
    input,select{padding:10px;border-radius:8px;border:1px solid #e6e9ef}
    table{width:100%;border-collapse:collapse;margin-top:14px}
    th,td{padding:10px;border-top:1px solid #eef2f7}

    .thumb{max-width:100px;border-radius:8px}

    .btn{background:var(--accent);color:#fff;padding:10px 12px;border:none;border-radius:8px;cursor:pointer}
  </style>
</head>
<body>

  <div class="app">
    <aside class="sidebar">
      <h2>Trading Journal</h2>
      <div class="nav">
        <a class="active">Dashboard</a>
        <a>Journal</a>
        <a>Reports</a>
      </div>
    </aside>

    <main class="main">
      <h1>Dashboard</h1>

      <section class="grid">
        <div class="card">
          <div class="sub">Total Trades</div>
          <div class="kpi" id="totalTrades">0</div>
        </div>
        <div class="card">
          <div class="sub">Win Rate</div>
          <div class="kpi" id="winRate">0%</div>
        </div>
        <div class="card">
          <div class="sub">Total P/L</div>
          <div class="kpi" id="totalPL">0</div>
        </div>
      </section>

      <section class="journal">
        <h2>Add Trade</h2>

        <form id="tradeForm">
          <div class="row">
            <input type="date" id="date" required />
            <input type="text" id="market" placeholder="Market" required />
            <select id="direction" required>
              <option value="">Direction</option>
              <option>Buy</option>
              <option>Sell</option>
            </select>
          </div>

          <div class="row">
            <input type="number" step="0.01" id="entry" placeholder="Entry" required />
            <input type="number" step="0.01" id="exit" placeholder="Exit" required />
            <input type="number" step="0.01" id="result" placeholder="P/L" />
          </div>

          <div class="row">
            <input type="file" id="screenshot" accept="image/*">
            <input type="text" id="tags" placeholder="Tags" />
            <button class="btn" type="submit">Add</button>
          </div>
        </form>

        <input id="filter" placeholder="Filter by market..." style="padding:8px;border-radius:8px;border:1px solid #ccc;margin-top:10px;width:250px">

        <table id="tradeTable">
          <thead>
            <tr>
              <th>Date</th><th>Market</th><th>Dir</th><th>Entry</th>
              <th>Exit</th><th>P/L</th><th>Tags</th><th>Shot</th><th>Del</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

      </section>

      <section class="card" style="margin-top:20px">
        <h2>Equity Chart</h2>
        <canvas id="equityChart" height="80"></canvas>
      </section>

    </main>
  </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
let trades = JSON.parse(localStorage.getItem("trades-lite") || "[]");
const tbody = document.querySelector("#tradeTable tbody");

function save(){ localStorage.setItem("trades-lite", JSON.stringify(trades)); }

function readFileAsDataURL(file){
  return new Promise(res=>{
    let r=new FileReader();
    r.onload=()=>res(r.result);
    r.readAsDataURL(file);
  });
}

function render(){
  tbody.innerHTML="";
  trades.forEach((t,i)=>{
    let tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${t.date}</td>
      <td>${t.market}</td>
      <td>${t.direction}</td>
      <td>${t.entry}</td>
      <td>${t.exit}</td>
      <td>${t.result}</td>
      <td>${t.tags||""}</td>
      <td>${t.screenshot ? `<img class="thumb" src="${t.screenshot}">` : "-"}</td>
      <td><button class="delBtn" data-i="${i}">üóëÔ∏è</button></td>
    `;
    tbody.appendChild(tr);
  });

  attachDeleteHandlers();
  updateKPIs();
  renderChart();
}

function attachDeleteHandlers(){
  document.querySelectorAll(".delBtn").forEach(btn=>{
    btn.onclick = ()=>{
      if(confirm("Delete this trade?")){
        trades.splice(btn.dataset.i,1);
        save();
        render();
      }
    }
  });
}

function updateKPIs(){
  document.getElementById("totalTrades").innerText = trades.length;
  const wins = trades.filter(t=>Number(t.result)>0).length;
  const totalPL = trades.reduce((s,t)=>s+Number(t.result||0),0);

  document.getElementById("winRate").innerText =
    trades.length ? ((wins/trades.length*100).toFixed(1)+"%") : "0%";

  document.getElementById("totalPL").innerText = totalPL.toFixed(2);
}

let chart;
function renderChart(){
  const pls = trades.map(t=>Number(t.result||0));
  let sum=0, eq=[];
  pls.forEach(p=>{ sum+=p; eq.push(sum); });

  const ctx = document.getElementById("equityChart").getContext("2d");
  if(chart) chart.destroy();

  chart = new Chart(ctx,{
    type:"line",
    data:{
      labels:eq.map((_,i)=>i+1),
      datasets:[{label:"Equity",data:eq,borderColor:"#2563eb"}]
    },
    options:{plugins:{legend:{display:false}}}
  });
}

document.getElementById("tradeForm").addEventListener("submit", async e=>{
  e.preventDefault();

  let file = screenshot.files[0];
  let imgData = file ? await readFileAsDataURL(file) : null;

  let t = {
    date:date.value,
    market:market.value,
    direction:direction.value,
    entry:entry.value,
    exit:exit.value,
    result:result.value,
    tags:tags.value,
    screenshot:imgData
  };

  trades.push(t);
  save();
  render();
  alert("Trade added!");
  e.target.reset();
});

document.getElementById("filter").addEventListener("input", e=>{
  const q=e.target.value.toLowerCase();
  tbody.querySelectorAll("tr").forEach(tr=>{
    tr.style.display = tr.children[1].innerText.toLowerCase().includes(q) ? "" : "none";
  });
});

window.onload = ()=>{ render(); };
</script>

</body>
</html>
